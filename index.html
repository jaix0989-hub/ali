<!doctype html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸµ AI Playlist Generator</title>

<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#0d0d0d">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #0d0d0d;
    --card: #181818;
    --border: #2a2a2a;
    --text: #eaeaea;
    --accent: #ffdb4d;
    --spotify: #1ed760;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    display: grid;
    min-height: 100vh;
    place-items: center;
  }
  .card {
    width: min(780px, 92vw);
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px;
    box-shadow: 0 0 40px rgba(0,0,0,.35);
  }
  textarea {
    width: 100%;
    background: #101010;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px;
    color: var(--text);
    font-size: 15px;
    resize: vertical;
  }
  button {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border-radius: 10px;
    cursor: pointer;
    border: none;
    font-weight: 600;
    transition: .15s;
    background: var(--accent);
    color: #000;
  }
  button:hover { filter: brightness(1.1); }
  button:disabled { opacity: .5; cursor: not-allowed; }

  #status {
    margin-top: 14px;
    font-size: 14px;
    white-space: pre-line;
  }

  #playlistResult img {
    width: 150px;
    border-radius: 12px;
    margin-bottom: 10px;
  }

  .track {
    display: flex;
    gap: 12px;
    align-items: center;
    background: #1b1d23;
    padding: 8px;
    border-radius: 10px;
  }
  .track img {
    width: 50px; height: 50px; border-radius: 6px;
  }
</style>
</head>
<body>

<div class="card">
  <h2 style="margin-top:0; font-size:22px">ğŸµ Ø³Ø§Ø®Øª Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h2>

  <textarea id="prompt" rows="4" placeholder="Ú†ÛŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ú¯ÙˆØ´ Ø¨Ø¯ÛŒØŸ"></textarea>

  <button id="btnCreate">Ø³Ø§Ø®Øª Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª</button>

  <div id="status"></div>
  <div id="playlistResult"></div>
</div>

<script>
const API_BASE = "https://ali-gpt.jaix0989.workers.dev";

const statusBox = document.getElementById("status");
const resultBox = document.getElementById("playlistResult");
const btn = document.getElementById("btnCreate");

function setStatus(text) {
  statusBox.textContent = text;
}

btn.addEventListener("click", async () => {
  const prompt = document.getElementById("prompt").value.trim();
  if (!prompt) return setStatus("âŒ Ù¾Ø±Ø§Ù…Ù¾Øª Ø®Ø§Ù„ÛŒÙ‡!");

  resultBox.innerHTML = "";
  setStatus("â³ Ø¯Ø±Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...");

  btn.disabled = true;

  try {
    const r = await fetch(`${API_BASE}/api/create-playlist`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    });

    const j = await r.json();

    if (!j.ok) {
      setStatus("âŒ Ø®Ø·Ø§: " + (j.error || "Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø§ÙˆÙ…Ø¯"));
      btn.disabled = false;
      return;
    }

    let meta = `âœ… Ù¾Ù„ÛŒâ€ŒÙ„ÛŒØ³Øª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯
ğŸ§ ØªØ±Ú©â€ŒÙ‡Ø§: ${j.added}
ğŸ” Ù…Ø¯Ù„: ${j.model_used}
${j.from_cache ? "â™»ï¸ Ù†ØªÛŒØ¬Ù‡ Ø§Ø² Ú©Ø´ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯" : ""}
`;

    setStatus(meta);

    let html = `
      <div style="text-align:center">
        <img src="${j.image}">
        <h3>${j.name}</h3>
        <a href="${j.playlist_url}" target="_blank">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø¯Ø± Ø§Ø³Ù¾Ø§ØªÛŒÙØ§ÛŒ</a>
      </div>
      <hr>
      <div style="display:grid;gap:10px">
    `;

    for (const t of j.tracks) {
      html += `
        <div class="track">
          <img src="${t.cover || ''}">
          <div>
            <b>${t.name}</b><br>
            <small>${t.artist}</small>
          </div>
        </div>
      `;
    }

    html += "</div>";
    resultBox.innerHTML = html;

  } catch (err) {
    setStatus("âŒ Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„ ÛŒØ§ Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø¹ØªØ¨Ø±");
  }

  btn.disabled = false;
});
</script>

</body>
</html>
